## Nginx의 주요 역할을 무엇인가요?

A: Nginx는 고성능 이벤트 기반 구조를 가진 **웹 서버**이자, **리버스 프록시** 및 **L7 로드밸런서** 역할을 수행합니다. 특히 로드밸런싱 측면에서는 L7 계층에서 동작하기 때문에, 단순 IP/포트 분산을 넘어 **HTTP 헤더, URL 경로, 쿠키** 등을 분석하여 정교한 트래픽 분산이 가능하다는 장점이 있습니다.

> Q: 그런데 L7 수준에서 패킷을 분석하면 L4보다 부하가 클 텐데, Nginx가 수만 명의 동시 접속을 어떻게 효율적으로 처리하나요?

Nginx의 이벤트 기반 비동기 구조를 이용해 효율적으로 처리할 수 있습니다. Apache 같은 방식은 프로세스나 스레드를 생성하여 자원낭비가 심하지만, Nginx는 적은 수의 워커 프로세스가 비동기 방식으로 수많은 요청을 처리하므로 L7 수준의 복잡한 분석을 수행하면서도 메모리 점유율을 낮게 유지할 수 있습니다.

> Q: 실제로 Nginx를 로드밸런서로 쓸 때 발생할 수 있는 문제나 고려해야 할 점은 무엇이 있을까요?

1. 세션 불일치 문제
	- [k] 로드 밸런싱으로 사용자가 A 서버에 로그인을 했는데, 다음 요청이 B 서버로 가면 로그인이 해제되는 문제
	- [I] Nginx의 `ip_hash` 설정을 사용하여 동일 사용자는 동일 서버로 보내거나, 별도의 Redis 서버를 두어 세션을 공유하게 설정
2.  헬스 체크
	- [k] 특정 백엔드 서버가 다운되었는데 Nginx가 계속 트래픽을 보내면 에러가 발생함
	- [I] Nginx의 헬스 체크 기능을 설정하여 응답이 없는 서버를 자동으로 배제하거나, `max_fails`와 `fail_timeout` 설정을 통해 장애 전파를 막습니다.
 3. 단일 장애점
	- [k] 로드밸런서 역할을 하는 Nginx 자체가 죽으면 서비스 전체가 중단됨.
	- [I] Nginx를 두 대 이상 띄우고 **Keepalived**나 **Keepalive** 같은 도구로 가상 IP(VIP)를 공유하여 고가용성 구성을 합니다.
